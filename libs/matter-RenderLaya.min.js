var Browser=laya.utils.Browser,Composite=Matter.Composite,Events=Matter.Events,Bounds=Matter.Bounds,Common=Matter.Common,Vertices=Matter.Vertices,Vector=Matter.Vector,Sleeping=Matter.Sleeping,Axes=Matter.Axes,Body=Matter.Body,SAT=Matter.SAT,Contact=Matter.Contact,Pair=Matter.Pair,Detector=Matter.Detector,Grid=Matter.Grid,LayaRender={};!function(){function a(a){var b=a.container;f=new Laya.Sprite,g=new Laya.Sprite,a.spriteContainer=f,a.graphicsContainer=g,b.addChild(f),b.addChild(g),e=g.graphics}function b(a){var b=a.options.background;7==b.length&&"#"==b[0]?f.graphics.drawRect(0,0,a.options.width,a.options.height,b):f.loadImage(b)}function c(){var a;a=1,Laya.Render.canvas.setAttribute("data-pixel-ratio",a)}function d(a,b){var c=new Laya.Sprite;return c.pivot(a,b),c.pos(-9999,-9999),f.addChild(c),c}var e,f,g;LayaRender.create=function(d){var e={controller:LayaRender,element:null,canvas:null,mouse:null,options:{width:800,height:600,pixelRatio:1,background:"#fafafa",wireframeBackground:"#222",hasBounds:!!d.bounds,enabled:!0,wireframes:!0,showSleeping:!0,showDebug:!1,showBroadphase:!1,showBounds:!1,showVelocity:!1,showCollisions:!1,showSeparations:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showShadows:!1,showVertexNumbers:!1,showConvexHulls:!1,showInternalEdges:!1,showMousePosition:!1}},f=Common.extend(e,d);return f.canvas=laya.renders.Render.canvas,f.context=laya.renders.Render.context.ctx,f.textures={},f.bounds=f.bounds||{min:{x:0,y:0},max:{x:Laya.stage.width,y:Laya.stage.height}},a(f),b(f),c(),f},LayaRender.world=function(a){var b,c=a.render,d=a.world,f=c.options,g=Composite.allConstraints(d),h=Composite.allBodies(d),i=[];if(f.hasBounds){var j=c.bounds.max.x-c.bounds.min.x,k=c.bounds.max.y-c.bounds.min.y;j/f.width,k/f.height;for(b=0;b<h.length;b++){var l=h[b];l.render.sprite.visible=Bounds.overlaps(l.bounds,c.bounds)}for(b=0;b<g.length;b++){var m=g[b],n=m.bodyA,o=m.bodyB,p=m.pointA,q=m.pointB;n&&(p=Vector.add(n.position,m.pointA)),o&&(q=Vector.add(o.position,m.pointB)),p&&q&&(Bounds.contains(c.bounds,p)||Bounds.contains(c.bounds,q))&&i.push(m)}}else i=g;for(e.clear(),b=0;b<h.length;b++)LayaRender.body(a,h[b]);for(b=0;b<i.length;b++)LayaRender.constraint(a,i[b])},LayaRender.body=function(a,b){var c=a.render,f=b.render;if(f.visible){var g=f.sprite,h=b.sprite;if(f.sprite&&f.sprite.texture)h||(h=b.sprite=d(g.xOffset,g.yOffset),h.loadImage(g.texture)),h.scale(g.xScale,g.yScale),h.pos(b.position.x,b.position.y),h.rotation=180*b.angle/Math.PI;else{var i=c.options;for(k=b.parts.length>1?1:0;k<b.parts.length;k++)if(part=b.parts[k],part.render.visible){var j=i.wireframes?null:part.render.fillStyle,l=part.render.lineWidth,m=part.render.strokeStyle;if(part.circleRadius)e.drawCircle(part.position.x,part.position.y,part.circleRadius,j,m,l);else{var n=[];n.push(part.vertices[0].x,part.vertices[0].y);for(var o=1;o<part.vertices.length;o++)!part.vertices[o-1].isInternal||showInternalEdges?n.push(part.vertices[o].x,part.vertices[o].y):n.push(part.vertices[o].x,part.vertices[o].y),part.vertices[o].isInternal&&!showInternalEdges&&n.push(part.vertices[(o+1)%part.vertices.length].x,part.vertices[(o+1)%part.vertices.length].y);e.drawPoly(0,0,n,j,m,l)}}}}},LayaRender.constraint=function(a,b){var c,d,f,g;if(b.render.visible&&b.pointA&&b.pointB){var h=b.bodyA,i=b.bodyB;h?(c=h.position.x+b.pointA.x,d=h.position.y+b.pointA.y):(c=b.pointA.x,d=b.pointA.y),i?(f=i.position.x+b.pointB.x,g=i.position.y+b.pointB.y):(f=b.pointB.x,g=b.pointB.y),e.drawLine(c,d,f,g,b.render.strokeStyle,b.render.lineWidth)}}}();